{{!-- Link Chart --}}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
{{!-- Title Tag SEO --}}
<head>
    <title>https://happyminds.onrender.com/</title>
</head>
{{!-- Title Meta description Tag--}}
<head>
    <meta name="description" content="
    {{!-- Content of desciption --}}
    Trang Web tập thể dục chất lượng cao, 
    nơi bạn có thể truy cập miễn phí và tận hưởng những buổi tập đa dạng, 
    giúp nâng cao sức khỏe và tinh thần của bạn!.
">
</head>
<header>
    <a href="https://happyminds.onrender.com/" style="display: none;">https://happyminds.onrender.com/</a>
</header>
<link rel="canonical" href="https://happyminds.onrender.com/">
<div class="heading">
    <h2 class="text-danger fw-bold text-center pt-3 pb-3">PROFILE</h2>
</div>
<div class="inforBlock bg-light m-5 rounded-3">
    <div class="avatar row justify-content-center align-items-top">
        <div class="col-lg-1 d-flex flex-row align-items-top"></div>
        <div class="col-lg-10 d-flex justify-content-center">
            <img class="profile_picture" style="width: 200px; height: 200px" src="./img/Ellipse 1.png"
                alt="profile_picture">
        </div>
        <div class="col-lg-1 mh-100 d-flex flex-row align-items-top justify-content-end" style="height: 40px;">
            <button class="d-flex flex-row align-items-top justify-content-end border-0 bg-light" data-bs-toggle="modal"
                data-bs-target="#userForm">
                <i class="bi bi-pencil-square editIcon fs-3 p-2 pt-0" id="editUser"></i>
            </button>
        </div>
    </div>

    <div class="name">
        <h2 class="text-center m-0 p-0" id="username"></h2>
    </div>
    <div class="modal fade" data-bs-backdrop="static" id="userForm" tabindex="-1" aria-labelledby="userFormLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header d-flex justify-content-end border-0">
                    <button class="closeModal m-0 p-0" data-bs-dismiss="modal" aria-label="Close">
                        <i class="bi bi-x-circle-fill fs-4 iconClose"></i>
                    </button>
                </div>
                <form id="updateForm">
                    <div class="modal-body border-0">
                        <div class="avatar row justify-content-center">
                            <div class="blank col-lg-3"></div>
                            <div class="col-lg-4 d-flex flex-column align-items-center">
                                <img class="" style="width: 160px; height: 160px" src="./img/Ellipse 1.png"
                                    alt="profile_picture">
                                <div class="changeProfilePicture pt-2" id="changePhoto">
                                    <input type="file" id="changeImg" class="d-none">
                                    <label
                                        class="buttonModal p-1 px-1 d-flex justify-content-center align-items-center"
                                        onclick="document.getElementById('changeImg').click();"
                                        style="width: 30px; height: 30px; border-radius: 50%">
                                        <i class="bi bi-camera-fill fs-6 "></i>
                                    </label>
                                </div>
                            </div>

                            <div class="blank col-lg-3"></div>
                        </div>
                        <div class="changeName mb-2">
                            <p class="m-0 py-2 fs-5 fw-bold">Họ và tên: </p>
                            <input class="formInput col-lg-12 p-2" type="text" name="name" id="nameInput" class=""
                                placeholder="">
                        </div>
                        <div class="row mb-2">
                            <div class="changeActivityRatios col-lg-6">
                                <p class="m-0 py-2 fs-5 fw-bold" >Mức độ hoạt động: </p>
                                <select class="formInput col-lg-12 p-2" name="pal" id="palSelection">
                                    {{#each ActivityStatus}}
                                        <option value="{{this}}" {{isSelected ../user.pal this}}> {{this}} </option>
                                    {{/each}}
                                </select>       
                            </div>
                            <div class="changeSex col-lg-6">
                                <p class="m-0 py-2 fs-5 fw-bold" >Giới tính: </p>
                                <select class="formInput col-lg-12 p-2" name="sex" id="sexSelection">
                                    <option value="Male" {{isSelected user.sex 'Male'}}>Nam</option>
                                    <option value="Female" {{isSelected user.sex 'Female'}}>Nữ</option>
                                </select>       
                            </div>
                        </div>
                        <div class="changeInfor row">
                            <div class="changeHeight col-lg-4">
                                <p class="m-0 py-2 fs-5 fw-bold">Chiều cao (cm): </p>
                                <input class="formInput col-lg-12 p-2" type="text" name="height" id="heightInput"
                                    class="" placeholder="Nhập chiều cao ">
                            </div>
                            <div class="changeWeight col-lg-4">
                                <p class="m-0 py-2 fs-5 fw-bold">Cân nặng (kg): </p>
                                <input class="formInput col-lg-12 p-2" type="text" name="weight" id="weightInput"
                                    class="" placeholder="Nhập cân nặng">
                            </div>
                            <div class="changeAge col-lg-4">
                                <p class="m-0 py-2 fs-5 fw-bold">Tuổi: </p>
                                <input class="formInput col-lg-12 p-2" type="text" name="age" id="ageInput" class=""
                                    placeholder="Nhập tuổi">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-0 d-flex justify-content-center">
                        <button type="submit" class="buttonModal" onclick=update()>Lưu thông tin</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="inforBar row p-2 pb-4 mx-2 mb-2 justify-content-center">
        <div class="firstitem item_inforBar col-lg-2 p-2 d-flex flex-row justify-content-center ">
            <img src="./img/bmi_logo.png" alt="">
            <div class="userInfor d-flex flex-column justify-content-center mx-1 fs-1">
                <h4 class="fs-3 " id="bmi"></h4>
                <h4 class="fs-3 ">BMI</h4>
            </div>
        </div>
        <div class="item_inforBar col-lg-2 p-2  d-flex flex-row justify-content-center">
            <img src="./img/height_logo.png" alt="">
            <div class="userInfor d-flex flex-column justify-content-center mx-1 fs-1">
                <h4 class="fs-3 " id="height"></h4>
                <h4 class="fs-3 ">CM</h4>
            </div>
        </div>
        <div class="item_inforBar col-lg-2 p-2  d-flex flex-row justify-content-center">
            <img src="./img/weight_logo.png" alt="">
            <div class="userInfor d-flex flex-column justify-content-center mx-1 fs-1">
                <h4 class="fs-3 " id="weight"></h4>
                <h4 class="fs-3 ">KG</h4>
            </div>
        </div>
        <div class="item_inforBar col-lg-2 p-2  d-flex flex-row justify-content-center">
            <img src="./img/age_logo.png" alt="">
            <div class="userInfor d-flex flex-column justify-content-center mx-1 fs-1">
                <h4 class="fs-3 " id="age"></h4>
                <h4 class="fs-3 ">AGE</h4>
            </div>
        </div>
        <div class="lastitem item_inforBar col-lg-2 p-2 px-3 d-flex flex-row justify-content-center ">
            <img src="./img/calo_logo.png" alt="">
            <div class="userInfor d-flex flex-column justify-content-center mx-1 fs-1">
                <h4 class="fs-3 " id="calo"></h4>
                <h4 class="fs-3 ">CALO</h4>
            </div>
        </div>
    </div>
</div>
<div class="chartBMI m-5">
    <div class="heading_user p-0">
        <h4 class="fw-bold p-0">BIỂU ĐỒ BMI</h4>
    </div>
    <div class="chart">
        <canvas id="canvas" style="background-color: white;"></canvas>
    </div>
</div>
<div class="courseBMI m-5">
    <div class="heading_user p-0">
        <h4 class="fw-bold p-0">KHOÁ HỌC</h4>
    </div>
    <div class="courses pt-2">
        <div class="row gap-2">
            {{#each videos1}}
            <div class="card col-3 p-2 mx-2 " style="width: 25rem;">
                <a href="/video/{{this.videoId}}" style="color: black; text-decoration: none;">
                    <img src="{{this.image}}" class="card-img-top" alt="image">
                    <div class="card-body">
                        <p class="card-text">{{this.title}}</p>
                    </div>
                </a>
            </div>
            {{/each}}
        </div>
    </div>
</div>
<div class="menu m-5">
    <div class="heading_user p-0">
        <h4 class="fw-bold p-0">THỰC ĐƠN</h4>
    </div>
    <div class="menu_table row">
        <table class="row">
            <thead>
                <tr class="row rounded-top" style="background-color: rgba(253, 0, 84, 1) ; ">
                    <td class="fw-bold col-lg-11 d-flex align-items-center " style="color: white; ">HÔM NAY</td>
                    <td class="fw-bold col-lg-1 d-flex justify-content-end  align-items-center p-2">
                        <button class="border-0 editMenu" data-bs-toggle="modal" data-bs-target="#menuModal">
                            <i class="bi bi-pencil-square fs-3  pt-0" id="editUser" style="color: white;"></i>
                        </button>
                    </td>
                </tr>
                <tr class="row bg-light p-2 border-bottom border-1 border-dark">
                    <td class="col-lg-2 text-center fw-bold fs-5 p-0">Tên</td>
                    <td class="col-lg-3 text-center fw-bold fs-5 p-0">Hình ảnh</td>
                    <td class="col-lg-2 text-center fw-bold fs-5 p-0">Calo/100g</td>
                    <td class="col-lg-2 text-center fw-bold fs-5 p-0">Khối lượng</td>
                    <td class="col-lg-3 text-center fw-bold fs-5 p-0">Phân loại</td>
                </tr>
            </thead>
            <tbody>
                {{#each foods}}
                <tr class="row bg-light p-2">
                    <td class="col-lg-2  fs-5 p-0 d-flex align-items-center justify-content-center">{{this.name}}</td>
                    <td class="col-lg-3  fs-5 p-0 d-flex align-items-center justify-content-center">
                        <img src="{{this.img}}" alt="" style="width: 80px; height: 70px;">
                    </td>
                    <td class="col-lg-2  fs-5 p-0 d-flex align-items-center justify-content-center">{{this.calo}}</td>
                    <td class="col-lg-2  fs-5 p-0 d-flex align-items-center justify-content-center">200g</td>
                    <td class="col-lg-3  fs-5 p-0 d-flex align-items-center justify-content-center">{{this.category}}
                    </td>
                </tr>
                {{/each}}

            </tbody>
        </table>
    </div>

</div>
<div class="modal fade" data-bs-backdrop="static" id="menuModal" tabindex="-1" aria-labelledby="menuModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header text-light" style="background-color: rgba(253, 0, 84, 1);">
                <h5 class="modal-title" id="menuModalLabel">MY MENU</h5>
                <button class="border-0" data-bs-dismiss="modal" aria-label="Close"
                    style="background-color: rgba(253, 0, 84, 1); color: white"><i
                        class="bi bi-x-circle-fill fs-4"></i></button>
            </div>
            <div class="modal-body pb-0">
                <table class=" border border-2 ">
                    <thead>
                        <tr class="text-center fw-bold justify-content-center "
                            style="background-color:rgb(216, 214, 214);">
                            <td style="width: 200px; height: 40px;">Tên</td>
                            <td style="width: 150px; height: 40px;">Calo/100g(calo)</td>
                            <td style="width: 150px; height: 40px;">Khối lượng(g)</td>
                            <td style="width: 150px; height: 40px;">Tổng calo</td>
                            <td style="width: 100px; height: 40px;">Xoá</td>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each foods}}
                        <tr class="text-center fw-bold justify-content-center">
                            <td class="menuRow">{{this.name}}</td>
                            <td class="menuRow">{{this.calo}}</td>
                            <td class="menuRow">200</td>
                            <td class="menuRow">{{this.calo}}</td>
                            <td class="menuRow" style="width: 100px; height: 40px;"><i
                                    class="bi bi-trash3-fill p-1 px-2 rounded-2"
                                    style="background-color: rgba(253, 0, 84, 1); color: white; cursor: pointer;"></i>
                            </td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
                <div class="line mt-4 my-2" style="height: 2px; background-color: rgb(211, 211, 211);"></div>
                <div class="totalMenu">
                    <div class="row justify-content-between pb-1">
                        <div class="col-lg-3 fw-semibold" style="font-size: 18px;">Items </div>
                        <div class="col-lg-3 fw-semibold d-flex justify-content-end" style="font-size: 18px;">6</div>
                    </div>
                    <div class="row justify-content-between pb-1">
                        <div class="col-lg-4 fw-semibold" style="font-size: 18px;">Your required calories </div>
                        <div class="col-lg-3 fw-semibold d-flex justify-content-end" style="font-size: 18px;">2000 calo
                        </div>
                    </div>
                    <div class="row justify-content-between pb-1">
                        <div class="col-lg-3 fw-semibold" style="font-size: 18px;">Total calories </div>
                        <div class="col-lg-3 fw-semibold d-flex justify-content-end" style="font-size: 18px;">2200 calo
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0 pt-1">
                <button type="button" class="btn border-0 fw-semibold" data-bs-dismiss="modal"
                    style="background-color:rgba(253, 0, 84, 1); color: white;">CLOSE</button>
                <button type="button" class="btn border-0 fw-semibold"
                    style="background-color:rgba(253, 0, 84, 1); color: white;">ADD TO MENU</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>


<script>
    let user = {{{ json user }}}
    renderInf();
    function renderInf() {
        document.querySelector("#username").textContent = `${user.name}` || '';
        document.querySelector("#bmi").textContent = `${user.BMIchange[user.BMIchange.length - 1]?.value || 0}` || '';
        document.querySelector("#height").textContent = `${user.height}`;
        document.querySelector("#weight").textContent = `${user.weight}`;
        document.querySelector("#age").textContent = `${user.age}`;

        document.querySelector("#calo").textContent = `${user.requiredCaloriesAmount}`;
        document.querySelector("#nameInput").value = `${user.name}`;
        document.querySelector("#heightInput").value = `${user.height}`;
        document.querySelector("#weightInput").value = `${user.weight}`;
        document.querySelector("#ageInput").value = `${user.age}`;
    }
    function update() {
        event.preventDefault();
        var form = document.getElementById('updateForm');
        var formData = new FormData(form);
        var data = [...formData];
        const dataObject = {};
        data.forEach(([key, value]) => {
            dataObject[key] = value;
        });
        axios.post('/user', dataObject)
            .then(function (response) {
                user = response.data;
                BMIchart(user);
                renderInf();
            })
            .catch(function (error) {
                console.error('Error:', error);
            });
    }

    //CHART
    const canvas = document.getElementById('canvas');
    let chart;
    function BMIchart(user){
        if (chart) {
            chart.destroy();
        }
        // Trích xuất mảng date và value từ mảng BMIchange
        const bmiDates = user.BMIchange.map(entry => entry.date);
        const bmiValues = user.BMIchange.map(entry => entry.value);

        const data = {
            labels: bmiDates,
            datasets: [
                {
                    label: 'BMI',
                    backgroundColor: 'pink',
                    borderColor: 'pink',
                    data: bmiValues,
                    tension: 0.4,
                }
            ]
        };

        const config = {
            type: 'line',
            data: data,
        };

        chart = new Chart(canvas, config);
    }
    BMIchart(user);
</script>
